MODULE InkMove
    ! Test code for picking and placing objects
	! Also includes some helper functions and an example of how to do user input.
    
    PERS jointtarget jCur;
    PERS robtarget   pCur;
    CONST num zTab := 147;
    CONST num zCon := 22.1;
        
    !VAR num i := 1;
    VAR num aPnP{2,5}:=[[-100,300,550,0,45],[100,350,450,0,30]];
    
    
    VAR num aDrawPt1{59,5}:= [[350.798,-179.966,349.028,-180.007,0],[349.028,-180.007,346.150,-180.073,0],[346.150,-180.073,343.240,-180.139,0],[343.240,-180.139,340.982,-180.191,0],[340.982,-180.191,338.945,-180.238,0],[338.945,-180.238,336.908,-180.285,0],[336.908,-180.285,334.871,-180.332,0],[334.871,-180.332,332.834,-180.378,0],[332.834,-180.378,330.798,-180.425,0],[330.798,-180.425,328.761,-180.472,0],[328.761,-180.472,326.724,-180.519,0],[326.724,-180.519,324.687,-180.565,0],[324.687,-180.565,322.650,-180.612,0],[322.650,-180.612,320.613,-180.659,0],[320.613,-180.659,318.613,-180.695,0],[318.613,-180.695,316.818,-180.673,0],[316.818,-180.673,315.391,-180.545,0],[315.391,-180.545,314.448,-180.278,0],[314.448,-180.278,314.058,-179.854,0],[314.058,-179.854,314.244,-179.264,0],[314.244,-179.264,314.985,-178.515,0],[314.985,-178.515,316.209,-177.628,0],[316.209,-177.628,317.800,-176.636,0],[317.800,-176.636,319.597,-175.585,0],[319.597,-175.585,321.431,-174.523,0],[321.431,-174.523,323.264,-173.462,0],[323.264,-173.462,325.097,-172.400,0],[325.097,-172.400,326.931,-171.339,0],[326.931,-171.339,328.764,-170.277,0],[328.764,-170.277,330.597,-169.216,0],[330.597,-169.216,332.430,-168.155,0],[332.430,-168.155,334.263,-167.093,0],[334.263,-167.093,336.096,-166.032,0],[336.096,-166.032,337.929,-164.971,0],[337.929,-164.971,339.726,-163.920,0],[339.726,-163.920,341.319,-162.926,0],[341.319,-162.926,342.547,-162.034,0],[342.547,-162.034,343.296,-161.277,0],[343.296,-161.277,343.497,-160.673,0],[343.497,-160.673,343.125,-160.229,0],[343.125,-160.229,342.205,-159.939,0],[342.205,-159.939,340.806,-159.784,0],[340.806,-159.784,339.042,-159.730,0],[339.042,-159.730,337.075,-159.734,0],[337.075,-159.734,335.071,-159.748,0],[335.071,-159.748,333.068,-159.761,0],[333.068,-159.761,331.064,-159.775,0],[331.064,-159.775,329.061,-159.789,0],[329.061,-159.789,327.057,-159.803,0],[327.057,-159.803,325.054,-159.816,0],[325.054,-159.816,323.050,-159.830,0],[323.050,-159.830,321.046,-159.844,0],[321.046,-159.844,319.043,-159.858,0],[319.043,-159.858,317.039,-159.871,0],[317.039,-159.871,314.818,-159.887,0],[314.818,-159.887,311.955,-159.906,0],[311.955,-159.906,309.124,-159.926,0],[309.124,-159.926,307.383,-159.938,0],[307.383,-159.938,307.021,-159.940,0]];
    VAR num aDrawPt{59,2}:=[[350.798,-179.966],[349.028,-180.007],[346.150,-180.073],[343.240,-180.139],[340.982,-180.191],[338.945,-180.238],[336.908,-180.285],[334.871,-180.332],[332.834,-180.378],[330.798,-180.425],[328.761,-180.472],[326.724,-180.519],[324.687,-180.565],[322.650,-180.612],[320.613,-180.659],[318.613,-180.695],[316.818,-180.673],[315.391,-180.545],[314.448,-180.278],[314.058,-179.854],[314.244,-179.264],[314.985,-178.515],[316.209,-177.628],[317.800,-176.636],[319.597,-175.585],[321.431,-174.523],[323.264,-173.462],[325.097,-172.400],[326.931,-171.339],[328.764,-170.277],[330.597,-169.216],[332.430,-168.155],[334.263,-167.093],[336.096,-166.032],[337.929,-164.971],[339.726,-163.920],[341.319,-162.926],[342.547,-162.034],[343.296,-161.277],[343.497,-160.673],[343.125,-160.229],[342.205,-159.939],[340.806,-159.784],[339.042,-159.730],[337.075,-159.734],[335.071,-159.748],[333.068,-159.761],[331.064,-159.775],[329.061,-159.789],[327.057,-159.803],[325.054,-159.816],[323.050,-159.830],[321.046,-159.844],[319.043,-159.858],[317.039,-159.871],[314.818,-159.887],[311.955,-159.906],[309.124,-159.926],[307.383,-159.938]];
    
    
    
    VAR num xi1 := -100;
    VAR num yi1 := 300;
    VAR num xf1 := 500;
    VAR num yf1 := 0;
    VAR num ang1 := 45;
    
    VAR robtarget pA := [[-100,300,zCon],[0,0,-1,0],[0,0,0,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    VAR robtarget pB := [[500,0,zTab],[0,0,-1,0],[0,0,0,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    
    CONST robtarget pZeros := [[0,0,0],[0,0,-1,0],[0,0,0,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    VAR pos xyzZeros := [0,0,0];
    
    VAR num userIn := -10;
    VAR num ang := 180;
    
    PROC Main()
        TPWrite "-------------- Start";  
        MoveToCalibPos;
        
        ! Get data from 
        
        
        PrintLetter 1, 1;
        
        !FOR i FROM 1 TO Dim(aPnP,1) DO
        !    PickNPlaceXYA aPnP{i,1}, aPnP{i,2}, aPnP{i,3}, aPnP{i,4}, aPnP{i,5};
        !ENDFOR
        
        MoveToCalibPos;
        
        TPWrite "-------------- Done";
        
    ENDPROC

    PROC PrintLetter(num data_recv_flag, num thick_thin)
        VAR robtarget Pos1 := pZeros;
        VAR robtarget Pos2 := pZeros;    
        VAR num Table_upOff := zTab + 50;
        ! if data_recv_flag =  1 there is data -> move 
        IF data_recv_flag = 1 THEN 
            Pos1.trans := [aDrawpt{1,1},aDrawpt{1,2},Table_upOff];

            ! Move just above the object
            MoveJ Offs(Pos1,0,0,0), v100, fine, tSCup;
            
            ! if 1 = thick line 
            IF thick_thin = 1 THEN 
                FOR i FROM 2 TO Dim(aDrawpt,1) DO
                    Pos1.trans := [aDrawpt{i,1},aDrawpt{i,2}, Table_upOff];
                    MoveL Pos1, v20, fine, tSCup;
                ENDFOR
            ELSEIF thick_thin = 2 THEN
               FOR i FROM 2 TO Dim(aDrawpt,1) DO
                    Pos1.trans := [aDrawpt{i,1},aDrawpt{i,2}, Table_upOff];
                    MoveL Pos1, v40, fine, tSCup;
                ENDFOR
            ENDIF
                ! A point just above the target 
                MoveJ Offs(Pos1,0,0,100), v100, fine, tSCup;
                ! MoveToCalibPos;
        ENDIF
    ENDPROC
    
    
    
    
ENDMODULE